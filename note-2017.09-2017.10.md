
# 9.6


## validation：

### 自动化id生成逻辑：

* ValidationPanel提供module属性，类型{string}，用来区分所属模块。

2. AutomationId根据模块单独计数。

3. 生成时计数器增加，销毁时计数器减少。 各模块内部，控制好自己的路由和render即可，不需要的页请销毁。

4. vmodule的值，用一个冻结的常量保存。


# 9.8


## id使用规则：

使用id的控件要有重复性检查，在id重复时，抛出异常。



# 9.14

## editableCell

### 部件

* 包含一个显示部件，用于显示内容。

* 包含一个编辑部件，用于编辑内容。

### Normal状态组

* 显示模式：显示文本内容。

* 编辑模式：显示编辑组件。

### 交互逻辑

* 初始化时，editableCell为[显示模式]。

* [编辑部件]和[显示部件]互斥存在。

* 模式转换，由datagrid触发editableCell的[cellStateChanged]事件。

* cellStateChanged触发时，根据args.newValue.cellState的值改变组件状态：

    * 'editing': 使用[currentValue]保存当前的[显示内容]。生成编辑控件。

    * 'normal-confirm'：确认修改，并生成显示部件。

    * 'normal-restore'：使用currentValue还原修改，并生成显示部件。

## datagrid 编辑模式

### 私有属性：

#### isCellEditing: 类型，boolean。表示datagrid的单元格中，是否有正处于[编辑模式]的单元格。默认值，false，表示没有。

* 单元格进入编辑模式后（单击，双击，F2），isCellEditing = true。

* [编辑模式]下点击ESC后，[isCellEditing = false]。

* [编辑模式]下失去焦点，[isCellEditing = false]。

### 交互逻辑

* 单击单元格时，进入[编辑模式]。

* 单元格失去焦点时，进入[显示模式]，并保存修改。

* 在模式切换时，触发[cellStateChanged]事件

### 键盘行为

* F2：如果单元格是可编辑的，使当前单元格进入[编辑模式]。[isDatagridEditing = true];

* ESC：如果单元格处于[编辑模式]，则取消编辑并恢复已在控件中进行的任何更改。之后进入[显示模式]。[isDatagridEditing = false];

* TAB：

    * 如果当前单元格处于[编辑模式]（[isCellEditing = true]），则将焦点移到当前行的下一个单元格,如果该单元格可编辑，进入[编辑模式]。如果焦点已经位于此行的最后一个单元格，则提交已进行的任何更改并将焦点移到下一行的第一个单元格。如果焦点位于控件的最后一个单元格，则将焦点按父容器的 Tab 键顺序移到下一个控件。

    * 如果当前单元格不处于编辑模式（[isCellEditing = false]），则将焦点按父容器的 Tab 键顺序移到前一个控件。

### Event

#### cellStateChanged：

* 参数：
    
    * e：jQuery事件参数
    
    * args：自定义事件参数

        * newValue：
            
            * cellState：类型：'string'。表示单元格的状态，'editing'表示单元格应该进入编辑状态。'normal-confirm'表示单元格应该进入显示状态，并确认修改。'normal-restore表示单元格应该进入显示状态，并还原修改。
            



